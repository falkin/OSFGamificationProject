
var express =require('express')
  , app = express()
  , api = express();

// app middleware

var allowCrossDomain = function(req, res, next) {
  res.header('Access-Control-Allow-Credentials', true);
res.header('Access-Control-Allow-Origin', "http://127.0.0.4");
res.header('Access-Control-Allow-Origin', "http://127.0.0.1:8020");
res.header('Access-Control-Allow-Methods', 'GET,POST,PUT,HEAD,DELETE,OPTIONS');
   res.header('Access-Control-Allow-Headers', 'X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version');  // res.set('Access-Control-Allow-Max-Age', 3600);
    next();
}


//...
app.configure(function() {
    app.use(express.bodyParser());
    app.use(express.cookieParser());
    app.use(express.session({ secret: 'cool beans' }));
    app.use(express.methodOverride());
    app.use(allowCrossDomain);
    app.use(app.router);
    app.use(express.static(__dirname + '/public'));
});


app.get('/test', function(req, res, next){
	console.log("{coucou}");
	 var body = 'menu';
  res.setHeader('Content-Type', 'application/json ');
  res.write(JSON.stringify({   "name": "hello-world get" }));
  res.end();
});
app.get('/testttt', function(req, res, next){
	console.log("{coucou}");
	 var body = 'menu';
  res.setHeader('Content-Type', 'application/json');
  res.write(JSON.stringify({   "name": "heeeeeeeeeeeello-world get " }));
  res.end();
});

app.post("/login", function(req, res){
	var user = req.param("user");
	var pass = req.param("pass")
	console.log("user="+user);
	console.log("pass="+pass);
		 var body = 'menu';
  res.setHeader('Content-Type', 'application/json');
  res.write(JSON.stringify({   "name": user }));
  res.end();
});

app.use(function(err, req, res, next){
  console.error(err.stack);
  res.send(500, 'Something broke!');
});

function errorHandler(err, req, res, next) {
  res.status(500);
  res.render('error', { error: err });
}

app.listen(3000, "127.0.0.10");

console.log('Server running at http://127.0.0.10:3000');
